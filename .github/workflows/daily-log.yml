name: Setup Daily Log Entry

on:
  schedule:
    # 9ì‹œ ì •ê° ì§€ì—°ì„ í”¼í•˜ê¸° ìœ„í•´ 9ì‹œ 17ë¶„(UTC 00:17)ìœ¼ë¡œ ì„¤ì •
    - cron: '17 0 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  add-daily-line:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Insert Decorated Daily Date
        run: |
          # 1. í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë‚ ì§œ ë° ì›” êµ¬í•˜ê¸°
          MONTH_PATH=$(date -u -d "+9 hours" "+%Y-%m")
          TODAY=$(date -u -d "+9 hours" "+%Y-%m-%d (%a)")
          FILENAME="logs/daily-log-${MONTH_PATH}.md"
          
          # 2. logs í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±
          mkdir -p logs
          
          # 3. í•´ë‹¹ ì›”ì˜ íŒŒì¼ì´ ì—†ìœ¼ë©´ ì´ˆê¸° ì œëª© ìƒì„±
          if [ ! -f "$FILENAME" ]; then
            echo "# ğŸ“… $MONTH_PATH Learning Log" > "$FILENAME"
            echo -e "ì´ë²ˆ ë‹¬ì˜ ì„±ì¥ì„ ê¸°ë¡í•©ë‹ˆë‹¤. ğŸŒ±\n" >> "$FILENAME"
          fi

          # 4. ì˜¤ëŠ˜ì˜ ìƒˆë¡œìš´ ë‚ ì§œ ì„¹ì…˜ ìƒì„± (ìµœì‹  ë‚ ì§œê°€ ìœ„ë¡œ ì˜¤ê²Œ)
          echo "> ### ğŸŒ± **$TODAY**" > temp_entry.md
          echo "- " >> temp_entry.md
          echo -e "\n---" >> temp_entry.md
          echo -e "\n" >> temp_entry.md
          
          # 5. ê¸°ì¡´ ì›”ë³„ íŒŒì¼ ë‚´ìš©ì„ ìƒˆ ì„¹ì…˜ ë’¤ì— ë¶™ì´ê¸°
          cat "$FILENAME" >> temp_entry.md
          mv temp_entry.md "$FILENAME"

      - name: Commit and Push
        run: |
          git config --global user.name "Duskafka"
          git config --global user.email "rlarlgus0206@naver.com"
          
          # íŒŒì¼ í•˜ë‚˜ê°€ ì•„ë‹ˆë¼ logs í´ë” ì „ì²´ì˜ ë³€ê²½ì‚¬í•­ì„ ì¶”ê°€
          git add logs/
          
          TODAY=$(date -u -d "+9 hours" "+%Y-%m-%d (%a)")
          git commit -m "chore: add daily log entry for $TODAY" || echo "No changes to commit"
          git push
