name: Setup Daily Log Entry

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ì˜¤ì „ 9ì‹œ = UTC 00:00
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  add-daily-line:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Insert Daily Date at the Very Top
        run: |
          # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë‚ ì§œ êµ¬í•˜ê¸°
          TODAY=$(date -u -d "+9 hours" +%Y-%m-%d)
          
          # 1. íŒŒì¼ì´ ì•„ì˜ˆ ì—†ìœ¼ë©´ ê¸°ë³¸ ì œëª©ì„ í¬í•¨í•´ì„œ ìƒì„±
          if [ ! -f daily-log.md ]; then
            echo "# ğŸŒ³ My Daily Learning Log" > daily-log.md
            echo -e "í•˜ë£¨ì˜ ê¸°ë¡ì„ ë‚¨ê¹ë‹ˆë‹¤.\n" >> daily-log.md
          fi

          # 2. ìƒˆë¡œìš´ ë‚ ì§œ ì¤„ì„ ì„ì‹œ íŒŒì¼ì˜ ë§¨ ìœ„ì— ì‘ì„±
          echo "* $TODAY: " > temp_log.md
          
          # 3. ê¸°ì¡´ íŒŒì¼ì˜ ë‚´ìš©ì„ ê·¸ ë’¤ì— ë¶™ì„
          cat daily-log.md >> temp_log.md
          
          # 4. ì„ì‹œ íŒŒì¼ì„ ë‹¤ì‹œ ì›ë³¸ íŒŒì¼ë¡œ êµì²´
          mv temp_log.md daily-log.md

      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          git add daily-log.md
          TODAY=$(date -u -d "+9 hours" +%Y-%m-%d)
          git commit -m "chore: add top log entry for $TODAY" || echo "No changes"
          git push
